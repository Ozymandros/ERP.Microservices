<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>&#128640; GitHub Actions Workflow Architecture | ERP Microservices Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="&#128640; GitHub Actions Workflow Architecture | ERP Microservices Documentation ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/Ozymandros/ERP.Microservices/blob/main/docs/deployment/GITHUB_ACTIONS_ARCHITECTURE.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="ERP Microservices">
            ERP Microservices
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="-github-actions-workflow-architecture">ğŸš€ GitHub Actions Workflow Architecture</h1>

<p><strong>Complete CI/CD Pipeline Architecture for ERP Microservices</strong><br>
Last Updated: October 31, 2025</p>
<hr>
<h2 id="-overview">ğŸ“‹ Overview</h2>
<p>All workflows follow the <strong>optimized three-phase pattern</strong>:</p>
<ol>
<li><strong>Phase 1 (Test)</strong> - Run in parallel</li>
<li><strong>Phase 2 (Build Images)</strong> - Build 7 services in parallel using matrix strategy</li>
<li><strong>Phase 3 (Deploy)</strong> - Deploy after all images ready</li>
</ol>
<hr>
<h2 id="-workflow-triggers--branches">ğŸ”„ Workflow Triggers &amp; Branches</h2>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GITHUB ACTION TRIGGERS                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Pull Request                    Push to Branch            â”‚
â”‚  â”œâ”€ Triggers: dotnet.yml         â”œâ”€ Triggers: workflow    â”‚
â”‚  â”œâ”€ On: develop, main            â”œâ”€ Branch: develop       â”‚
â”‚  â””â”€ Actions:                     â””â”€ Actions:              â”‚
â”‚     âœ… Restore                       âœ… Restore           â”‚
â”‚     âœ… Build                         âœ… Build             â”‚
â”‚     âœ… Test                          âœ… Test              â”‚
â”‚     âŒ Deploy                        âœ… Build Images      â”‚
â”‚                                     âœ… Deploy to Dev     â”‚
â”‚                                                             â”‚
â”‚                     Push to Main                            â”‚
â”‚                     â”œâ”€ Triggers: azure-deploy.yml          â”‚
â”‚                     â”œâ”€ Actions:                            â”‚
â”‚                     â”‚  âœ… Restore                          â”‚
â”‚                     â”‚  âœ… Build (strict: fail on error)    â”‚
â”‚                     â”‚  âœ… Test (strict: fail on error)    â”‚
â”‚                     â”‚  âœ… Build Images                    â”‚
â”‚                     â”‚  âœ… Deploy to Production            â”‚
â”‚                     â””â”€ Manual: workflow_dispatch           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr>
<h2 id="-workflow-comparison-table">ğŸ“Š Workflow Comparison Table</h2>
<table>
<thead>
<tr>
<th>Workflow</th>
<th>Trigger</th>
<th>Environment</th>
<th>Test</th>
<th>Build</th>
<th>Deploy</th>
<th>Branch</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>dotnet.yml</strong></td>
<td>Pull Request</td>
<td>None</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âŒ</td>
<td>develop/main</td>
</tr>
<tr>
<td><strong>azure-dev.yml</strong></td>
<td>Push</td>
<td>DEV</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
<td>develop</td>
</tr>
<tr>
<td><strong>azure-deploy.yml</strong></td>
<td>Push</td>
<td>PROD</td>
<td>âœ… Strict</td>
<td>âœ… Strict</td>
<td>âœ…</td>
<td>main</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="-complete-cicd-flow">ğŸ”€ Complete CI/CD Flow</h2>
<pre><code>Developer Creates Feature Branch
    â†“
Commits &amp; Pushes to Feature Branch
    â†“
Creates Pull Request to develop
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  dotnet.yml TRIGGERED           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  Actions:                       â”‚
â”‚  1. Checkout code               â”‚
â”‚  2. Setup .NET 8.x &amp; 9.x        â”‚
â”‚  3. Cache NuGet packages        â”‚
â”‚  4. Restore dependencies        â”‚
â”‚  5. Build solution              â”‚
â”‚  6. Run unit tests              â”‚
â”‚                                 â”‚
â”‚  Result: âœ… All tests pass      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    âœ… Approval to Merge
    â†“
Merge to develop
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  azure-dev.yml TRIGGERED                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  PHASE 1: TEST (runs in parallel)            â”‚
â”‚  â”œâ”€ Checkout                                 â”‚
â”‚  â”œâ”€ Setup .NET 8.x &amp; 9.x                     â”‚
â”‚  â”œâ”€ Cache NuGet packages                     â”‚
â”‚  â”œâ”€ Restore &amp; Build solution                 â”‚
â”‚  â””â”€ Run unit tests (continue on error)       â”‚
â”‚                                              â”‚
â”‚  PHASE 2: BUILD IMAGES (7 parallel jobs)     â”‚
â”‚  â”œâ”€ Azure login (federated credentials)      â”‚
â”‚  â”œâ”€ ACR login                                â”‚
â”‚  â”œâ”€ Matrix[0]: auth-service                  â”‚
â”‚  â”‚  â”œâ”€ az acr build                          â”‚
â”‚  â”‚  â”œâ”€ --image auth-service:latest           â”‚
â”‚  â”‚  â”œâ”€ --image auth-service:&lt;sha&gt;            â”‚
â”‚  â”‚  â””â”€ --file src/.../Dockerfile             â”‚
â”‚  â”œâ”€ Matrix[1]: billing-service               â”‚
â”‚  â”œâ”€ Matrix[2]: inventory-service             â”‚
â”‚  â”œâ”€ Matrix[3]: orders-service                â”‚
â”‚  â”œâ”€ Matrix[4]: purchasing-service            â”‚
â”‚  â”œâ”€ Matrix[5]: sales-service                 â”‚
â”‚  â””â”€ Matrix[6]: erp-api-gateway               â”‚
â”‚                                              â”‚
â”‚  PHASE 3: DEPLOY (after Phase 2)             â”‚
â”‚  â”œâ”€ Checkout                                 â”‚
â”‚  â”œâ”€ Install azd                              â”‚
â”‚  â”œâ”€ Azure login (federated)                  â”‚
â”‚  â”œâ”€ azd provision --no-prompt                â”‚
â”‚  â”œâ”€ azd deploy --no-prompt                   â”‚
â”‚  â””â”€ Verify deployment                        â”‚
â”‚                                              â”‚
â”‚  Result: âœ… Services deployed to DEV         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Create PR from develop to main
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  dotnet.yml TRIGGERED (again)   â”‚
â”‚  (Same as before)               â”‚
â”‚                                 â”‚
â”‚  Result: âœ… All tests pass      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    âœ… Approval &amp; Merge to main
    â†“
Push to main
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  azure-deploy.yml TRIGGERED                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  PHASE 1: TEST (strict: FAIL on error)       â”‚
â”‚  â”œâ”€ Restore &amp; Build                          â”‚
â”‚  â””â”€ Run unit tests (stop on failure)         â”‚
â”‚                                              â”‚
â”‚  PHASE 2: BUILD IMAGES (7 parallel jobs)     â”‚
â”‚  â”œâ”€ Same matrix as dev                       â”‚
â”‚  â”œâ”€ Push to PROD ACR                         â”‚
â”‚  â””â”€ Tags: latest + commit SHA                â”‚
â”‚                                              â”‚
â”‚  PHASE 3: DEPLOY (strict)                    â”‚
â”‚  â”œâ”€ azd provision --no-prompt (PROD)         â”‚
â”‚  â”œâ”€ azd deploy --no-prompt (PROD)            â”‚
â”‚  â””â”€ Verify deployment                        â”‚
â”‚                                              â”‚
â”‚  Result: âœ… Services deployed to PROD        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
âœ… All Services Running in Production
</code></pre>
<hr>
<h2 id="-job-dependencies--parallelization">ğŸ“¦ Job Dependencies &amp; Parallelization</h2>
<h3 id="dotnetyml"><strong>dotnet.yml</strong></h3>
<pre><code>âœ“ Single job: test
  â””â”€ Runs sequentially (restore â†’ build â†’ test)
</code></pre>
<h3 id="azure-devyml--azure-deployyml"><strong>azure-dev.yml &amp; azure-deploy.yml</strong></h3>
<pre><code>Phase 1 (1 job)          Phase 2 (7 parallel jobs)          Phase 3 (1 job)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚                       â”‚                                   â”‚
â”œâ”€ test                 â”œâ”€ build-images[0]                 â”œâ”€ deploy
â”‚  â”œâ”€ restore           â”‚   â”œâ”€ auth-service                â”‚  â”œâ”€ checkout
â”‚  â”œâ”€ build             â”‚   â”œâ”€ az acr build                â”‚  â”œâ”€ install azd
â”‚  â”œâ”€ test              â”‚   â””â”€ push to ACR                 â”‚  â”œâ”€ azure login
â”‚  â””â”€ âœ…               â”‚                                   â”‚  â”œâ”€ provision
â”‚                       â”œâ”€ build-images[1]                 â”‚  â”œâ”€ deploy
â”‚                       â”‚   â”œâ”€ billing-service             â”‚  â””â”€ verify
â”‚                       â”‚   â””â”€ ...                          â”‚  â””â”€ âœ…
â”‚                       â”‚                                   â”‚
â”‚                       â”œâ”€ build-images[2]                 â”‚
â”‚                       â”‚   â”œâ”€ inventory-service           â”‚
â”‚                       â”‚   â””â”€ ...                          â”‚
â”‚                       â”‚                                   â”‚
â”‚                       â”œâ”€ build-images[3..6]              â”‚
â”‚                       â”‚   â””â”€ (remaining services)         â”‚
â”‚                       â”‚   â””â”€ âœ… all images ready          â”‚
â”‚                       â”‚                                   â”‚
                                                        â¬‡ï¸ needs: build-images


LEGEND:
âœ“ Runs independently
â¬‡ï¸ Depends on previous phase
ğŸ”„ Parallel execution
</code></pre>
<hr>
<h2 id="-estimated-execution-times">â±ï¸ Estimated Execution Times</h2>
<h3 id="dotnetyml-pr"><strong>dotnet.yml (PR)</strong></h3>
<pre><code>Restore:     2 min
Build:       5 min
Test:        8 min
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total:      ~15 min
</code></pre>
<h3 id="azure-devyml-develop-branch"><strong>azure-dev.yml (develop branch)</strong></h3>
<pre><code>Phase 1 (test):           ~15 min
Phase 2 (build Ã— 7):      ~12 min (parallel, cached layers)
Phase 3 (provision+deploy): ~15 min
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total:                   ~42 min
</code></pre>
<h3 id="azure-deployyml-main-branch"><strong>azure-deploy.yml (main branch)</strong></h3>
<pre><code>Phase 1 (test strict):     ~15 min (strict: fails on error)
Phase 2 (build Ã— 7):       ~12 min (parallel)
Phase 3 (provision+deploy): ~20 min (production setup)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total:                    ~47 min
</code></pre>
<hr>
<h2 id="-authentication--permissions">ğŸ” Authentication &amp; Permissions</h2>
<h3 id="federated-credentials-oidc"><strong>Federated Credentials (OIDC)</strong></h3>
<pre><code class="lang-yaml">Trigger: GitHub Actions pushes event
    â†“
Azure AD receives token request
    â†“
Validates: github.com certificate
    â†“
Validates: branch (develop/main)
    â†“
Validates: repository owner (Ozymandros)
    â†“
âœ… Issues short-lived token (no secrets needed)
    â†“
Workflow uses token to authenticate to Azure
</code></pre>
<h3 id="secrets-used"><strong>Secrets Used</strong></h3>
<pre><code>âŒ AZURE_CLIENT_ID      â†’ Uses vars (not secret)
âŒ AZURE_TENANT_ID      â†’ Uses vars (not secret)
âŒ AZURE_SUBSCRIPTION_ID â†’ Uses vars (not secret)
âœ… SQL_ADMIN_PASSWORD    â†’ Uses secrets (if needed)
âœ… JWT_SECRET_KEY        â†’ Uses secrets (if needed)
</code></pre>
<hr>
<h2 id="-debugging--monitoring">ğŸ› Debugging &amp; Monitoring</h2>
<h3 id="check-workflow-status"><strong>Check Workflow Status</strong></h3>
<pre><code>GitHub UI: Settings â†’ Actions â†’ Workflows
Timeline shows:
  âœ… test job (15 min)
  âœ… build-images[0-6] (12 min parallel)
  âœ… deploy (15 min)
</code></pre>
<h3 id="view-logs"><strong>View Logs</strong></h3>
<pre><code>Each job has collapsible logs:
  - Checkout code
  - Setup .NET
  - Cache operations
  - Restore dependencies
  - Build solution
  - Run unit tests
  - Azure login
  - ACR login
  - az acr build commands
  - azd provision output
  - azd deploy output
</code></pre>
<h3 id="common-issues"><strong>Common Issues</strong></h3>
<table>
<thead>
<tr>
<th>Issue</th>
<th>Cause</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td>Tests fail</td>
<td>Code broken</td>
<td>Fix code before merge</td>
</tr>
<tr>
<td>Image build fails</td>
<td>Dockerfile error</td>
<td>Check Dockerfile path</td>
</tr>
<tr>
<td>Deploy fails</td>
<td>Infrastructure issue</td>
<td>Check azd output logs</td>
</tr>
<tr>
<td>Auth fails</td>
<td>Token expired</td>
<td>Verify federated credentials</td>
</tr>
<tr>
<td>ACR login fails</td>
<td>Registry mismatch</td>
<td>Check registry name in env</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="-optimization-features">ğŸ“ˆ Optimization Features</h2>
<h3 id="1-parallel-execution"><strong>1. Parallel Execution</strong></h3>
<p>âœ… Test job runs while waiting for user approval<br>
âœ… 7 Docker image builds run simultaneously<br>
âœ… Saves ~30 min compared to sequential builds</p>
<h3 id="2-caching"><strong>2. Caching</strong></h3>
<p>âœ… NuGet package cache (key: csproj files)<br>
âœ… ACR layer caching (automatic)<br>
âœ… GitHub Actions cache across runs</p>
<h3 id="3-matrix-strategy"><strong>3. Matrix Strategy</strong></h3>
<p>âœ… One job definition, 7 parallel executions<br>
âœ… Each service: independent build &amp; push<br>
âœ… Fail-fast: false â†’ continues if one fails</p>
<h3 id="4-federated-credentials"><strong>4. Federated Credentials</strong></h3>
<p>âœ… No stored secrets in GitHub<br>
âœ… Automatic token generation per job<br>
âœ… Time-limited tokens (1 hour)</p>
<h3 id="5-conditional-error-handling"><strong>5. Conditional Error Handling</strong></h3>
<pre><code>DEV:  Tests can fail, deploy continues
PROD: Tests must pass, deploy stops on error
</code></pre>
<hr>
<h2 id="-workflow-files-location">ğŸ“ Workflow Files Location</h2>
<pre><code>.github/workflows/
â”œâ”€â”€ dotnet.yml                           # PR validation (15 min)
â”œâ”€â”€ azure-dev.yml                        # Dev deployment (42 min)
â”œâ”€â”€ azure-deploy.yml                     # Prod deployment (47 min)
â””â”€â”€ azure-build-deploy.yml               # âš ï¸ Legacy (can be removed)
</code></pre>
<hr>
<h2 id="-matrix-strategy-details">ğŸ¯ Matrix Strategy Details</h2>
<h3 id="service-matrix-used-in-phase-2"><strong>Service Matrix (Used in Phase 2)</strong></h3>
<pre><code class="lang-yaml">strategy:
  matrix:
    service:
      - name: auth-service
        dockerfile: src/MyApp.Auth/MyApp.Auth.API/Dockerfile
      - name: billing-service
        dockerfile: src/MyApp.Billing/MyApp.Billing.API/Dockerfile
      - name: inventory-service
        dockerfile: src/MyApp.Inventory/MyApp.Inventory.API/Dockerfile
      - name: orders-service
        dockerfile: src/MyApp.Orders/MyApp.Orders.API/Dockerfile
      - name: purchasing-service
        dockerfile: src/MyApp.Purchasing/MyApp.Purchasing.API/Dockerfile
      - name: sales-service
        dockerfile: src/MyApp.Sales/MyApp.Sales.API/Dockerfile
      - name: erp-api-gateway
        dockerfile: src/ErpApiGateway/Dockerfile
  fail-fast: false  # Continue if one fails
</code></pre>
<p><strong>Execution:</strong></p>
<pre><code>Job 1: auth-service       â†’ starts immediately
Job 2: billing-service    â†’ starts immediately
Job 3: inventory-service  â†’ starts immediately
...
Job 7: erp-api-gateway    â†’ starts immediately

All 7 run in parallel, each takes ~2 min
Total: ~2 min (not 14 min)
</code></pre>
<hr>
<h2 id="-image-tagging-strategy">ğŸ”„ Image Tagging Strategy</h2>
<p>Each image gets <strong>two tags</strong>:</p>
<pre><code>auth-service:latest      â† Always points to latest build
auth-service:&lt;commit-sha&gt; â† Specific to this commit

Example:
  docker pull myappdevcontainerregistry.azurecr.io/auth-service:latest
  docker pull myappdevcontainerregistry.azurecr.io/auth-service:a1b2c3d
</code></pre>
<p><strong>Benefits:</strong>
âœ… Rollback to specific commit<br>
âœ… Track which build is running<br>
âœ… Production debugging easier</p>
<hr>
<h2 id="-phase-descriptions">ğŸ“‹ Phase Descriptions</h2>
<h3 id="phase-1-test"><strong>Phase 1: Test</strong></h3>
<pre><code>âœ“ Restore NuGet packages (cache hit: ~10s)
âœ“ Build solution in Release mode (~5 min)
âœ“ Run all unit tests (~8 min)

Continue-on-error behavior:
  DEV:  If tests fail, continue to Phase 2
  PROD: If tests fail, STOP (no deploy)
</code></pre>
<h3 id="phase-2-build-images"><strong>Phase 2: Build Images</strong></h3>
<pre><code>For each service (7 total, in parallel):
  âœ“ Checkout repository
  âœ“ Azure federated login
  âœ“ ACR login
  âœ“ Execute: az acr build
      â”œâ”€ Dockerfile path
      â”œâ”€ Tag: latest
      â”œâ”€ Tag: commit-sha
      â””â”€ Source: src/ directory

All 7 services push to ACR in parallel (~12 min)
</code></pre>
<h3 id="phase-3-deploy"><strong>Phase 3: Deploy</strong></h3>
<pre><code>âœ“ Checkout repository
âœ“ Install azd tool
âœ“ Azure federated login
âœ“ azd provision (infrastructure)
  â”œâ”€ Creates resource groups
  â”œâ”€ Creates storage
  â”œâ”€ Creates databases
  â”œâ”€ Creates container apps
  â””â”€ (~5-10 min)
âœ“ azd deploy (services)
  â”œâ”€ Updates container app revisions
  â”œâ”€ Pulls images from ACR
  â”œâ”€ Deploys 7 services
  â””â”€ (~5-10 min)
âœ“ Verify deployment (health checks)
</code></pre>
<hr>
<h2 id="-next-steps">ğŸš€ Next Steps</h2>
<ol>
<li><strong>Monitor first deployment</strong> - Watch workflow logs</li>
<li><strong>Set up branch protections</strong> - Require checks to pass</li>
<li><strong>Configure alerts</strong> - Get notified on failures</li>
<li><strong>Document environment variables</strong> - For team reference</li>
<li><strong>Set up manual approval gates</strong> - For production deployments</li>
</ol>
<hr>
<h2 id="-quick-reference">ğŸ“ Quick Reference</h2>
<table>
<thead>
<tr>
<th>Need</th>
<th>Workflow</th>
<th>Time</th>
<th>Trigger</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Test code</strong></td>
<td>dotnet.yml</td>
<td>15 min</td>
<td>PR to develop/main</td>
</tr>
<tr>
<td><strong>Deploy to Dev</strong></td>
<td>azure-dev.yml</td>
<td>42 min</td>
<td>Push to develop</td>
</tr>
<tr>
<td><strong>Deploy to Prod</strong></td>
<td>azure-deploy.yml</td>
<td>47 min</td>
<td>Push to main</td>
</tr>
<tr>
<td><strong>Manual deploy</strong></td>
<td>Any workflow</td>
<td>-</td>
<td>workflow_dispatch</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>Last Updated:</strong> October 31, 2025<br>
<strong>Status:</strong> âœ… Optimized &amp; Production-Ready<br>
<strong>Optimization:</strong> 3-phase parallel execution with matrix builds</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/Ozymandros/ERP.Microservices/blob/main/docs/deployment/GITHUB_ACTIONS_ARCHITECTURE.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          ERP Microservices - A cloud-native ERP system built with .NET 9
        </div>
      </div>
    </footer>
  </body>
</html>
