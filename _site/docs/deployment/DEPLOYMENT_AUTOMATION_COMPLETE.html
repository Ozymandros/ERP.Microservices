<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>&#128640; BUILD &amp; DEPLOY AUTOMATION - COMPLETE SOLUTION | ERP Microservices Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="&#128640; BUILD &amp; DEPLOY AUTOMATION - COMPLETE SOLUTION | ERP Microservices Documentation ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/Ozymandros/ERP.Microservices/blob/main/docs/deployment/DEPLOYMENT_AUTOMATION_COMPLETE.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="ERP Microservices">
            ERP Microservices
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="-build--deploy-automation---complete-solution">🚀 BUILD &amp; DEPLOY AUTOMATION - COMPLETE SOLUTION</h1>

<h2 id="problem-fixed-">Problem Fixed ✅</h2>
<p><strong>Error you encountered:</strong></p>
<pre><code>ERROR: MANIFEST_UNKNOWN: manifest tagged by &quot;latest&quot; is not found
</code></pre>
<p><strong>Root cause:</strong> Container Apps tried to deploy services but the Docker images didn't exist in ACR.</p>
<p><strong>Solution:</strong> Fully automated build + deploy pipeline using:</p>
<ul>
<li>PowerShell script for local development</li>
<li>GitHub Actions for CI/CD</li>
<li>Bicep infrastructure as code</li>
</ul>
<hr>
<h2 id="what-was-created">What Was Created</h2>
<h3 id="1--powershell-build-script">1. 📝 PowerShell Build Script</h3>
<p><strong>File:</strong> <code>infra/scripts/build-push-images.ps1</code></p>
<p>Builds and pushes all 7 Docker images to Azure Container Registry.</p>
<p><strong>Usage:</strong></p>
<pre><code class="lang-powershell">./infra/scripts/build-push-images.ps1
</code></pre>
<p><strong>Features:</strong></p>
<ul>
<li>✓ Builds all services in parallel (fast)</li>
<li>✓ Uses ACR's build system (cached layers)</li>
<li>✓ Automatic retry on failure</li>
<li>✓ Detailed progress reporting</li>
<li>✓ Works offline after authentication</li>
</ul>
<h3 id="2--github-actions-workflow">2. 🔄 GitHub Actions Workflow</h3>
<p><strong>File:</strong> <code>.github/workflows/azure-build-deploy.yml</code></p>
<p>Automated pipeline that runs on every push to <code>main</code> or <code>develop</code>.</p>
<p><strong>Pipeline:</strong></p>
<ol>
<li>Build images in ACR</li>
<li>Push with tag (commit hash + latest)</li>
<li>Deploy with <code>azd deploy</code></li>
<li>Verify all services healthy</li>
</ol>
<h3 id="3--deployment-wrapper-script">3. 📚 Deployment Wrapper Script</h3>
<p><strong>File:</strong> <code>Deploy.ps1</code></p>
<p>Simple wrapper to run build + deploy + verify in one command.</p>
<p><strong>Usage:</strong></p>
<pre><code class="lang-powershell">./Deploy.ps1               # Deploy to dev
./Deploy.ps1 -Environment prod  # Deploy to prod
./Deploy.ps1 -SkipBuild   # Only deploy (images already exist)
</code></pre>
<h3 id="4--documentation">4. 📖 Documentation</h3>
<p><strong>Files:</strong></p>
<ul>
<li><code>docs/deployment/BUILD_AND_DEPLOY_AUTOMATION.md</code> - Complete guide</li>
<li><code>docs/deployment/QUICK_START_BUILD_DEPLOY.md</code> - Quick reference</li>
</ul>
<hr>
<h2 id="how-to-use">How to Use</h2>
<h3 id="-local-development">👨‍💻 Local Development</h3>
<p><strong>Step 1: Build images</strong></p>
<pre><code class="lang-powershell">cd C:\Projects\ERP_ASPIRE_APP\src
./infra/scripts/build-push-images.ps1
</code></pre>
<p><strong>Step 2: Deploy</strong></p>
<pre><code class="lang-powershell">azd up
</code></pre>
<p><strong>Or do both at once:</strong></p>
<pre><code class="lang-powershell">./Deploy.ps1
</code></pre>
<h3 id="-cicd-github-actions">🤖 CI/CD (GitHub Actions)</h3>
<p><strong>Setup (one-time):</strong></p>
<ol>
<li><p>Add GitHub Secrets:</p>
<ul>
<li><code>AZURE_CLIENT_ID</code></li>
<li><code>AZURE_TENANT_ID</code></li>
<li><code>AZURE_SUBSCRIPTION_ID</code></li>
</ul>
</li>
<li><p>Enable Federated Credentials in Azure:</p>
<pre><code class="lang-powershell"># See Azure AD app registration settings
</code></pre>
</li>
</ol>
<p><strong>Usage:</strong></p>
<pre><code class="lang-bash">git push origin main
# GitHub Actions automatically:
# 1. Builds images
# 2. Deploys
# 3. Verifies health
</code></pre>
<hr>
<h2 id="architecture-overview">Architecture Overview</h2>
<pre><code>┌─────────────────────────────────────┐
│  Source Code (7 Microservices)      │
│  + Dockerfiles                      │
└─────────────────────────────────────┘
         ↓
┌─────────────────────────────────────┐
│  Build Step                         │
│  - ./build-push-images.ps1          │
│  - OR GitHub Actions                │
│  - OR Manual az acr build           │
└─────────────────────────────────────┘
         ↓
┌─────────────────────────────────────┐
│  Azure Container Registry (ACR)     │
│  - auth-service:latest              │
│  - billing-service:latest           │
│  - ... 5 more services              │
│  - erp-api-gateway:latest           │
└─────────────────────────────────────┘
         ↓
┌─────────────────────────────────────┐
│  Bicep Deployment                   │
│  - Infrastructure provisioning      │
│  - Container Apps creation          │
│  - RBAC configuration               │
└─────────────────────────────────────┘
         ↓
┌─────────────────────────────────────┐
│  Azure Container Apps               │
│  - 7 services running               │
│  - DAPR enabled                     │
│  - Health checks passing            │
│  - Ready for traffic                │
└─────────────────────────────────────┘
</code></pre>
<hr>
<h2 id="key-files">Key Files</h2>
<table>
<thead>
<tr>
<th>File</th>
<th>Purpose</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>infra/scripts/build-push-images.ps1</code></td>
<td>Build images locally</td>
<td><code>./infra/scripts/build-push-images.ps1</code></td>
</tr>
<tr>
<td><code>Deploy.ps1</code></td>
<td>One-command deploy</td>
<td><code>./Deploy.ps1</code></td>
</tr>
<tr>
<td><code>.github/workflows/azure-build-deploy.yml</code></td>
<td>CI/CD automation</td>
<td>Triggered on push</td>
</tr>
<tr>
<td><code>infra/core/build/acr-build.bicep</code></td>
<td>Bicep documentation</td>
<td>Reference</td>
</tr>
<tr>
<td><code>docs/deployment/BUILD_AND_DEPLOY_AUTOMATION.md</code></td>
<td>Complete guide</td>
<td>Read for details</td>
</tr>
<tr>
<td><code>docs/deployment/QUICK_START_BUILD_DEPLOY.md</code></td>
<td>Quick reference</td>
<td>Read for quick setup</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="what-gets-built">What Gets Built</h2>
<h3 id="services-7-total">Services (7 total)</h3>
<ol>
<li>✓ <code>auth-service</code> (MyApp.Auth)</li>
<li>✓ <code>billing-service</code> (MyApp.Billing)</li>
<li>✓ <code>inventory-service</code> (MyApp.Inventory)</li>
<li>✓ <code>orders-service</code> (MyApp.Orders)</li>
<li>✓ <code>purchasing-service</code> (MyApp.Purchasing)</li>
<li>✓ <code>sales-service</code> (MyApp.Sales)</li>
<li>✓ <code>erp-api-gateway</code> (ErpApiGateway)</li>
</ol>
<h3 id="image-tags">Image Tags</h3>
<ul>
<li><code>latest</code> - Always points to current build</li>
<li><code>{commit-hash}</code> - In CI/CD for traceability</li>
</ul>
<hr>
<h2 id="workflow-examples">Workflow Examples</h2>
<h3 id="example-1-local-development">Example 1: Local Development</h3>
<pre><code class="lang-powershell"># Make code changes
code MyApp.Auth/MyApp.Auth.API/Controllers/AuthController.cs

# Build images
./infra/scripts/build-push-images.ps1
# ✓ Built and pushed auth-service:latest
# ✓ Built and pushed ... (5 more services)
# ✓ All images built and pushed successfully!

# Deploy
azd up
# Infrastructure provisioned
# Container Apps deployed
# Services running at configured FQDNs
</code></pre>
<h3 id="example-2-production-deployment-cicd">Example 2: Production Deployment (CI/CD)</h3>
<pre><code class="lang-bash"># Push changes to main branch
git push origin main

# GitHub Actions automatically:
# 1. Builds all services in ACR (parallel)
# 2. Tags with commit hash + latest
# 3. Runs azd deploy
# 4. Verifies all services healthy
# 5. Sends notification

# Check GitHub Actions tab for progress
# Takes ~15-20 minutes total
</code></pre>
<h3 id="example-3-redeployment-images-already-built">Example 3: Redeployment (Images Already Built)</h3>
<pre><code class="lang-powershell"># Skip build step if images already exist
./Deploy.ps1 -SkipBuild

# Or just run azd
azd deploy
</code></pre>
<hr>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="build-script-fails">Build Script Fails</h3>
<p><strong>Check authentication:</strong></p>
<pre><code class="lang-powershell">az login
az account set --subscription &quot;your-subscription-id&quot;
az acr login --name myappdevcontainerregistry
</code></pre>
<p><strong>Check ACR exists:</strong></p>
<pre><code class="lang-powershell">az acr list --output table
</code></pre>
<h3 id="images-not-found-after-build">Images Not Found After Build</h3>
<pre><code class="lang-powershell"># Verify images were built
az acr repository list --name myappdevcontainerregistry

# Check specific repository
az acr repository show-tags --name myappdevcontainerregistry --repository auth-service
</code></pre>
<h3 id="container-apps-wont-start">Container Apps Won't Start</h3>
<pre><code class="lang-powershell"># Check revision status
az containerapp revision list --name myapp-dev-auth-service --resource-group rg-myapp-dev-core

# Check logs
az containerapp logs show --name myapp-dev-auth-service --resource-group rg-myapp-dev-core --tail 50

# Check image pull errors
az containerapp show --name myapp-dev-auth-service --resource-group rg-myapp-dev-core --query &quot;properties.template&quot;
</code></pre>
<hr>
<h2 id="best-practices">Best Practices</h2>
<h3 id="-do">✅ DO</h3>
<ul>
<li>✓ Run build script before <code>azd up</code> locally</li>
<li>✓ Use commit hash for image tags in production</li>
<li>✓ Always tag with <code>latest</code> for development</li>
<li>✓ Test locally before pushing to GitHub</li>
<li>✓ Monitor GitHub Actions workflow runs</li>
<li>✓ Check Container App health after deployment</li>
</ul>
<h3 id="-dont">❌ DON'T</h3>
<ul>
<li>✗ Run <code>azd up</code> without building images first</li>
<li>✗ Commit secrets to GitHub (use Secrets feature)</li>
<li>✗ Deploy manually - use automation</li>
<li>✗ Skip health checks before considering deployment complete</li>
<li>✗ Forget to verify images in ACR after build</li>
</ul>
<hr>
<h2 id="performance">Performance</h2>
<h3 id="build-time">Build Time</h3>
<ul>
<li><strong>Local (7 services):</strong> 10-15 minutes</li>
<li><strong>GitHub Actions (parallel):</strong> 8-12 minutes</li>
<li><strong>ACR (cached layers):</strong> 2-5 minutes if only one service changed</li>
</ul>
<h3 id="deploy-time">Deploy Time</h3>
<ul>
<li><strong>Infrastructure:</strong> 5-10 minutes</li>
<li><strong>Container startup:</strong> 2-3 minutes</li>
<li><strong>Total:</strong> 15-20 minutes</li>
</ul>
<hr>
<h2 id="security">Security</h2>
<h3 id="authentication">Authentication</h3>
<ul>
<li>✓ Federated credentials (GitHub Actions)</li>
<li>✓ Managed identity for Container Apps</li>
<li>✓ RBAC for ACR access</li>
<li>✓ Secrets stored in GitHub (not in code)</li>
<li>✓ Service Principal credentials via Entra ID</li>
</ul>
<h3 id="image-security">Image Security</h3>
<ul>
<li>✓ Images scanned by ACR (vulnerability scanning)</li>
<li>✓ Signed with ACR notary (optional)</li>
<li>✓ Only latest tags auto-deployed</li>
<li>✓ Production uses specific version tags</li>
</ul>
<hr>
<h2 id="next-steps">Next Steps</h2>
<h3 id="immediate-today">Immediate (Today)</h3>
<pre><code class="lang-powershell">./infra/scripts/build-push-images.ps1
azd up
</code></pre>
<h3 id="short-term-this-week">Short Term (This Week)</h3>
<ul>
<li>Test all service endpoints</li>
<li>Verify DAPR communication</li>
<li>Check logs in Application Insights</li>
<li>Run HTTP test suite (auth-tests.http, permissions-tests.http)</li>
</ul>
<h3 id="medium-term-this-sprint">Medium Term (This Sprint)</h3>
<ul>
<li>Setup GitHub Actions (add secrets)</li>
<li>Enable automatic deploys on push</li>
<li>Configure deployment approvals</li>
<li>Setup monitoring dashboards</li>
</ul>
<hr>
<h2 id="reference">Reference</h2>
<h3 id="commands">Commands</h3>
<p><strong>Build images locally:</strong></p>
<pre><code class="lang-powershell">./infra/scripts/build-push-images.ps1
</code></pre>
<p><strong>Deploy:</strong></p>
<pre><code class="lang-powershell">azd up
</code></pre>
<p><strong>One-command deploy:</strong></p>
<pre><code class="lang-powershell">./Deploy.ps1 -Environment dev
</code></pre>
<p><strong>Verify deployment:</strong></p>
<pre><code class="lang-powershell">./Deploy.ps1 -Verify
</code></pre>
<p><strong>Check Container App status:</strong></p>
<pre><code class="lang-powershell">az containerapp show --name myapp-dev-auth-service --resource-group rg-myapp-dev-core --query &quot;properties.latestRevisionFqdn&quot;
</code></pre>
<p><strong>View logs:</strong></p>
<pre><code class="lang-powershell">az containerapp logs show --name myapp-dev-auth-service --resource-group rg-myapp-dev-core --tail 100
</code></pre>
<h3 id="documentation">Documentation</h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/container-registry/">Azure Container Registry</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/container-apps/">Azure Container Apps</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/">Azure Developer CLI</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/developer/github/">GitHub Actions with Azure</a></li>
</ul>
<hr>
<h2 id="support">Support</h2>
<p><strong>Need help?</strong></p>
<ol>
<li>Check <code>docs/deployment/BUILD_AND_DEPLOY_AUTOMATION.md</code> for detailed guide</li>
<li>Check <code>docs/deployment/QUICK_START_BUILD_DEPLOY.md</code> for quick reference</li>
<li>Review this file (DEPLOYMENT_AUTOMATION_COMPLETE.md)</li>
</ol>
<p><strong>Something broken?</strong></p>
<ol>
<li>Check build script output for errors</li>
<li>Verify Azure authentication: <code>az login</code></li>
<li>Check ACR contains images: <code>az acr repository list --name myappdevcontainerregistry</code></li>
<li>Review Container App logs for startup errors</li>
</ol>
<hr>
<p><strong>Summary:</strong> You now have a complete, production-ready build and deployment automation system. No more &quot;manifest not found&quot; errors! 🎉</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/Ozymandros/ERP.Microservices/blob/main/docs/deployment/DEPLOYMENT_AUTOMATION_COMPLETE.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          ERP Microservices - A cloud-native ERP system built with .NET 9
        </div>
      </div>
    </footer>
  </body>
</html>
